package resources

import (
	"encoding/json"
	"errors"
	"net/http"
	"net/http/httptest"
	"strings"
	"testing"

	"github.com/gorilla/mux"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/mock"

	"github.com/Financial-Times/nativerw/pkg/mapper"
)

const exampleNativePayload = `{"attributes":"\u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003c!DOCTYPE ObjectMetadata SYSTEM \"/SysConfig/Classify/FTStories/classify.dtd\"\u003e\u003cObjectMetadata\u003e\n\t\u003cEditorialDisplayIndexing\u003e\n\t\t\u003cDILeadCompanies/\u003e\n\t\t\u003cDITemporaryCompanies\u003e\n\t\t\t\u003cDITemporaryCompany\u003e\n\t\t\t\t\u003cDICoTempCode/\u003e\n\t\t\t\t\u003cDICoTempDescriptor/\u003e\n\t\t\t\t\u003cDICoTickerCode/\u003e\n\t\t\t\u003c/DITemporaryCompany\u003e\n\t\t\u003c/DITemporaryCompanies\u003e\n\t\t\u003cDIFTSEGlobalClassifications/\u003e\n\t\t\u003cDIStockExchangeIndices/\u003e\n\t\t\u003cDIHotTopics/\u003e\n\t\t\u003cDIHeadlineCopy\u003eInteractive: The Virgin empire\u003c/DIHeadlineCopy\u003e\n\t\t\u003cDIBylineCopy\u003eBy Aleksandra Wisniewska\u003c/DIBylineCopy\u003e\n\n\t\t\u003cDIFTNPSections/\u003e\n\t\t\n\t\t\n\t\u003cDIFirstParCopy\u003e\n\u003c/DIFirstParCopy\u003e\u003cDIMasterImgFileRef/\u003e\u003c/EditorialDisplayIndexing\u003e\n\t\u003cOutputChannels\u003e\n\t\t\u003cDIFTN\u003e\n\t\t\t\u003cDIFTNPublicationDate/\u003e\n\t\t\t\u003cDIFTNZoneEdition/\u003e\n\t\t\t\u003cDIFTNPage/\u003e\n\t\t\t\u003cDIFTNTimeEdition/\u003e\n\t\t\t\u003cDIFTNFronts/\u003e\n\t\t\u003c/DIFTN\u003e\n\t\t\u003cDIFTcom\u003e\n\t\t\t\u003cDIFTcomWebType\u003estory\u003c/DIFTcomWebType\u003e\n\t\t\t\u003cDIFTcomDisplayCodes\u003e\n\t\t\t\t\u003cDIFTcomDisplayCodeRank1/\u003e\n\t\t\t\t\u003cDIFTcomDisplayCodeRank2\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Companies\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eBNIP\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eCompanies\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag/\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Industrials - Aerospace \u0026amp; Defence\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eNDAD\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eIndustrials - Aerospace \u0026amp;\n\t\t\t\t\t\t\tDefence\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag\u003eAerospace \u0026amp; Defence\u003c/DIFTcomDisplayCodeEditorsTag\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Retail \u0026amp; Consumer - Retail\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eR0T8\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eRetail \u0026amp; Consumer - Retail\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag\u003eRetail\u003c/DIFTcomDisplayCodeEditorsTag\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Retail \u0026amp; Consumer - Travel \u0026amp; Leisure\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eNDRE\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eRetail \u0026amp; Consumer - Travel \u0026amp;\n\t\t\t\t\t\t\tLeisure\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag\u003eRetailing \u0026amp; Leisure\u003c/DIFTcomDisplayCodeEditorsTag\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Transport - Rail\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eT0R8\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eTransport - Rail\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag\u003eRail\u003c/DIFTcomDisplayCodeEditorsTag\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Retail \u0026amp; Consumer\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eNDCI\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eRetail \u0026amp; Consumer\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag\u003eRetail \u0026amp; Consumer\u003c/DIFTcomDisplayCodeEditorsTag\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Transport - Airlines\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eT8A0\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eTransport - Airlines\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag\u003eAirlines\u003c/DIFTcomDisplayCodeEditorsTag\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Transport\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eNDTR\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eTransport\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag/\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Financials - Banks\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eB08K\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eFinancials - Banks\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag\u003eBanks\u003c/DIFTcomDisplayCodeEditorsTag\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Financials\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eNDFS\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eFinancials\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag\u003eFinancials\u003c/DIFTcomDisplayCodeEditorsTag\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Telecoms\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eNDTC\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eTelecoms\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag/\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\t\u003cDIFTcomDisplayCode title=\"Media\"\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeFTCode\u003eNDME\u003c/DIFTcomDisplayCodeFTCode\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeDescriptor\u003eMedia\u003c/DIFTcomDisplayCodeDescriptor\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeNewsInDepth\u003eTrue\u003c/DIFTcomDisplayCodeNewsInDepth\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeSite\u003eFTcom\u003c/DIFTcomDisplayCodeSite\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleType\u003eNews\u003c/DIFTcomDisplayCodeArticleType\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeArticleBrand/\u003e\n\t\t\t\t\t\t\u003cDIFTcomDisplayCodeEditorsTag\u003eMedia\u003c/DIFTcomDisplayCodeEditorsTag\u003e\n\t\t\t\t\t\u003c/DIFTcomDisplayCode\u003e\n\t\t\t\t\u003c/DIFTcomDisplayCodeRank2\u003e\n\t\t\t\u003c/DIFTcomDisplayCodes\u003e\n\t\t\t\u003cDIFTcomSubscriptionLevel\u003e0\u003c/DIFTcomSubscriptionLevel\u003e\n\t\t\t\u003cDIFTcomUpdateTimeStamp\u003eFalse\u003c/DIFTcomUpdateTimeStamp\u003e\n\t\t\t\u003cDIFTcomIndexAndSynd\u003efalse\u003c/DIFTcomIndexAndSynd\u003e\n\t\t\t\u003cDIFTcomSafeToSyndicate\u003eTrue\u003c/DIFTcomSafeToSyndicate\u003e\n\t\t\t\u003cDIFTcomInitialPublication\u003e20140805134048\u003c/DIFTcomInitialPublication\u003e\n\t\t\t\u003cDIFTcomLastPublication\u003e20140805134048\u003c/DIFTcomLastPublication\u003e\n\t\t\t\u003cDIFTcomSuppresInlineAds\u003eFalse\u003c/DIFTcomSuppresInlineAds\u003e\n\t\t\t\u003cDIFTcomMap\u003eTrue\u003c/DIFTcomMap\u003e\n\t\t\t\u003cDIFTcomDisplayStyle\u003eNormal\u003c/DIFTcomDisplayStyle\u003e\n\t\t\t\u003cDIFTcomFeatureType\u003eNormal\u003c/DIFTcomFeatureType\u003e\n\t\t\t\u003cDIFTcomMarkDeleted\u003eFalse\u003c/DIFTcomMarkDeleted\u003e\n\t\t\t\u003cDIFTcomMakeUnlinkable\u003eFalse\u003c/DIFTcomMakeUnlinkable\u003e\n\t\t\t\u003cisBestStory\u003e0\u003c/isBestStory\u003e\n\t\t\t\u003cDIFTcomCMRId\u003e2813496\u003c/DIFTcomCMRId\u003e\n\t\t\t\u003cDIFTcomCMRHint/\u003e\n\t\t\t\u003cDIFTcomCMR\u003e\n\t\t\t\t\u003cDIFTcomCMRPrimarySection\u003eThe Big Read\u003c/DIFTcomCMRPrimarySection\u003e\n\t\t\t\t\u003cDIFTcomCMRPrimarySectionId\u003eMTE4-U2VjdGlvbnM=\u003c/DIFTcomCMRPrimarySectionId\u003e\n\t\t\t\t\u003cDIFTcomCMRPrimaryTheme/\u003e\n\t\t\t\t\u003cDIFTcomCMRPrimaryThemeId/\u003e\n\t\t\t\t\u003cDIFTcomCMRBrand/\u003e\n\t\t\t\t\u003cDIFTcomCMRBrandId/\u003e\n\t\t\t\t\u003cDIFTcomCMRGenre\u003eNews\u003c/DIFTcomCMRGenre\u003e\n\t\t\t\t\u003cDIFTcomCMRGenreId\u003eNw==-R2VucmVz\u003c/DIFTcomCMRGenreId\u003e\n\t\t\t\t\u003cDIFTcomCMRMediaType\u003eInteractive\u003c/DIFTcomCMRMediaType\u003e\n\t\t\t\t\u003cDIFTcomCMRMediaTypeId\u003eNDVjNTMwNWQtMjAwNy00ZDZiLTk5YzAtMzhiZDlmNzM2MTU3-TWVkaWFUeXBlcw==\u003c/DIFTcomCMRMediaTypeId\u003e\n\t\t\t\u003c/DIFTcomCMR\u003e\n\n\n\n\n\n\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\u003cDIFTcomECPositionInText\u003eDefault\u003c/DIFTcomECPositionInText\u003e\u003cDIFTcomHideECLevel1\u003eFalse\u003c/DIFTcomHideECLevel1\u003e\u003cDIFTcomHideECLevel2\u003eFalse\u003c/DIFTcomHideECLevel2\u003e\u003cDIFTcomHideECLevel3\u003eFalse\u003c/DIFTcomHideECLevel3\u003e\u003cDIFTcomDiscussion\u003eTrue\u003c/DIFTcomDiscussion\u003e\u003cDIFTcomArticleImage\u003ePrimary size\u003c/DIFTcomArticleImage\u003e\u003c/DIFTcom\u003e\n\t\t\u003cDISyndication\u003e\n\t\t\t\u003cDISyndBeenCopied\u003eFalse\u003c/DISyndBeenCopied\u003e\n\t\t\t\u003cDISyndEdition\u003eUSA\u003c/DISyndEdition\u003e\n\t\t\t\u003cDISyndStar\u003e01\u003c/DISyndStar\u003e\n\t\t\t\u003cDISyndChannel/\u003e\n\t\t\t\u003cDISyndArea/\u003e\n\t\t\t\u003cDISyndCategory/\u003e\n\t\t\u003c/DISyndication\u003e\n\t\u003c/OutputChannels\u003e\n\t\u003cEditorialNotes\u003e\n\t\t\u003cLanguage\u003eEnglish\u003c/Language\u003e\n\t\t\u003cAuthor\u003ekilbyn\u003c/Author\u003e\n\t\t\u003cGuides/\u003e\n\t\t\u003cEditor/\u003e\n\t\t\u003cSources\u003e\n\n\t\t\t\u003cSource title=\"FT Content Placeholder\"\u003e\n\t\t\t\t\u003cSourceCode\u003eContentPlaceholder\u003c/SourceCode\u003e\n\t\t\t\t\u003cSourceDescriptor\u003eFT ContentPlaceholder\u003c/SourceDescriptor\u003e\n\t\t\t\t\u003cSourceOnlineInclusion\u003eTrue\u003c/SourceOnlineInclusion\u003e\n\t\t\t\t\u003cSourceCanBeSyndicated\u003eFalse\u003c/SourceCanBeSyndicated\u003e\n\t\t\t\u003c/Source\u003e\n\t\t\u003c/Sources\u003e\n\t\t\u003cWordCount\u003e86\u003c/WordCount\u003e\n\t\t\u003cCreationDate/\u003e\n\t\t\u003cEmbargoDate/\u003e\n\t\t\u003cExpiryDate/\u003e\n\t\t\u003cObjectLocation\u003e/FT/Content/Links/Warsi resig letter.xml\u003c/ObjectLocation\u003e\n\t\t\u003cOriginatingStory\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/OriginatingStory\u003e\n\n\t\t\u003cCCMS\u003e\n\t\t\t\u003cCCMSCommissionRefNo/\u003e\n\t\t\t\u003cCCMSContributorRefNo/\u003e\n\t\t\t\u003cCCMSContributorFullName/\u003e\n\t\t\t\u003cCCMSContributorInclude/\u003e\n\t\t\t\u003cCCMSContributorRights\u003e4\u003c/CCMSContributorRights\u003e\n\t\t\t\u003cCCMSFilingDate/\u003e\n\t\t\t\u003cCCMSProposedPublishingDate/\u003e\n\t\t\u003c/CCMS\u003e\n\t\u003c/EditorialNotes\u003e\n\t\u003cWiresIndexing\u003e\n\t\t\u003ccategory/\u003e\n\t\t\u003cKeyword/\u003e\n\t\t\u003cchar_count/\u003e\n\t\t\u003cpriority/\u003e\n\t\t\u003cbasket/\u003e\n\t\t\u003ctitle/\u003e\n\t\t\u003cVersion/\u003e\n\t\t\u003cstory_num/\u003e\n\t\t\u003cfile_name/\u003e\n\t\t\u003cserviceid/\u003e\n\t\t\u003centry_date/\u003e\n\t\t\u003cref_field/\u003e\n\t\t\u003ctake_num/\u003e\n\t\u003c/WiresIndexing\u003e\n\n\t\u003cDataFactoryIndexing\u003e\n\t\t\u003cADRIS_MetaData\u003e\n\t\t\t\u003cIndexSuccess\u003eyes\u003c/IndexSuccess\u003e\n\t\t\t\u003cStartTime\u003eTue Aug 05 13:40:48 GMT 2014\u003c/StartTime\u003e\n\t\t\t\u003cEndTime\u003eTue Aug 05 13:40:48 GMT 2014\u003c/EndTime\u003e\n\t\t\u003c/ADRIS_MetaData\u003e\n\t\t\u003cDFMajorCompanies/\u003e\n\t\t\u003cDFMinorCompanies/\u003e\n\t\t\u003cDFNAICS/\u003e\n\t\t\u003cDFWPMIndustries/\u003e\n\t\t\u003cDFFTSEGlobalClassifications/\u003e\n\t\t\u003cDFStockExchangeIndices/\u003e\n\t\t\u003cDFSubjects\u003e\n\t\t\t\u003cDFSubject\u003e\n\t\t\t\t\u003cDFSUFTCode\u003eON05\u003c/DFSUFTCode\u003e\n\t\t\t\t\u003cDFSUDescriptor\u003eComment_\u0026amp;_Analysis\u003c/DFSUDescriptor\u003e\n\t\t\t\t\u003cVersion\u003e1\u003c/Version\u003e\n\t\t\t\u003c/DFSubject\u003e\n\t\t\t\u003cDFSubject\u003e\n\t\t\t\t\u003cDFSUFTCode\u003eON\u003c/DFSUFTCode\u003e\n\t\t\t\t\u003cDFSUDescriptor\u003eGeneral_News\u003c/DFSUDescriptor\u003e\n\t\t\t\t\u003cVersion\u003e1\u003c/Version\u003e\n\t\t\t\u003c/DFSubject\u003e\n\t\t\u003c/DFSubjects\u003e\n\t\t\u003cDFCountries/\u003e\n\t\t\u003cDFRegions/\u003e\n\t\t\u003cDFWPMRegions/\u003e\n\t\t\u003cDFProvinces/\u003e\n\t\t\u003cDFFTcomDisplayCodes/\u003e\n\t\t\u003cDFFTSections/\u003e\n\t\t\u003cDFWebRegions/\u003e\n\t\u003c/DataFactoryIndexing\u003e\n\u003c/ObjectMetadata\u003e","lastModified":"2017-01-20T09:38:25.005Z","systemAttributes":"\u003cprops\u003e\u003cproductInfo\u003e\u003cname\u003eFTcom\u003c/name\u003e\n\u003cissueDate\u003e20140805\u003c/issueDate\u003e\n\u003c/productInfo\u003e\n\u003cworkFolder\u003e/FT/WorldNews\u003c/workFolder\u003e\n\u003csubFolder\u003eUKNews\u003c/subFolder\u003e\n\u003ctemplateName\u003e/SysConfig/Templates/FT/Base-Story.xml\u003c/templateName\u003e\n\u003csummary\u003eWhat started as a record company delivering vinyl records by post has grown into a conglomerate of more than 400 businesses ranging from telecoms to bridal wear. Juggling spaceships, mortgages, vodka bottles and wedding dresses made Sir Richard Branson, Virginâs chairman, the seventh richest billionaire in the UK with a net worth approaching $5 bn. Virginâs unorthodox corporate structure may have raised a couple of eyebrows but have not yet failed to finance its founderâs risky ventures and dari...\u003c/summary\u003e\u003cwordCount\u003e86\u003c/wordCount\u003e\u003c/props\u003e","type":"EOM::CompoundStory","usageTickets":"\u003c?xml version='1.0' encoding='UTF-8'?\u003e\u003ctl\u003e\u003ct\u003e\u003cid\u003e1\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003ewatkinsa\u003c/c\u003e\u003ccd\u003e20161215172300\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 15 17:23:32 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e4\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161215172300\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1481822617\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e5\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003ewatkinsa\u003c/c\u003e\u003ccd\u003e20161216161300\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eFri Dec 16 16:13:24 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e6\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161216161300\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1481904806\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e7\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161222142100\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 22 14:21:18 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e8\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161222142100\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1482416480\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e9\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161222144800\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 22 14:48:09 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e10\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161222144800\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1482418096\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e11\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161228143100\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eWed Dec 28 14:31:15 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e12\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161228143100\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1482935484\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e13\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161229120900\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 29 12:09:56 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e14\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161229121000\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483013399\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e15\u003c/id\u003e\u003ctp\u003eWebLink\u003c/tp\u003e\u003cc\u003esinghn\u003c/c\u003e\u003ccd\u003e20161229122900\u003c/cd\u003e\u003cdt\u003e\u003cuid lid=\"116.0.3169885872\" path=\"/FT/Content/Lists/Home-UK/ Home-UK Top Stories_test neetu.dwc\"\u003e001c8b1a-8487-11e5-8ee0-0442f38a1f32\u003c/uid\u003e\u003cchannel\u003eFTcom\u003c/channel\u003e\u003cissueDate\u003e20150408\u003c/issueDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e16\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003esinghn\u003c/c\u003e\u003ccd\u003e20161229123200\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 29 12:32:17 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e17\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161229123200\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483014740\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e18\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161229124000\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 29 12:40:23 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e19\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161229124000\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483015233\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e20\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161229124200\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 29 12:42:59 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e21\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161229124300\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483015381\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e22\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161229124300\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 29 12:43:55 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e23\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161229124300\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483015437\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e24\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161229131100\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 29 13:11:20 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e25\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161229131100\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483017082\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e26\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161229141200\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 29 14:12:17 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e27\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161229141200\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483020739\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e28\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161229144100\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 29 14:41:16 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e29\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161229144100\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483022478\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e30\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161229144300\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eThu Dec 29 14:43:54 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e31\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161229144300\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483022636\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e32\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003esinghn\u003c/c\u003e\u003ccd\u003e20161230110600\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eFri Dec 30 11:06:58 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e33\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161230110700\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483096021\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e34\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003esinghn\u003c/c\u003e\u003ccd\u003e20161230130900\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eFri Dec 30 13:09:19 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e35\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161230130900\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483103362\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e36\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161230132900\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eFri Dec 30 13:29:31 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e3\u003c/id\u003e\u003ctp\u003eWebCopy\u003c/tp\u003e\u003cc\u003epanzieral\u003c/c\u003e\u003ccd\u003e20161230132900\u003c/cd\u003e\u003cdt\u003e\u003crep\u003ecms@ftcmr01-uvpr-uk-p\u003c/rep\u003e\u003cfirst\u003e20161215172332\u003c/first\u003e\u003clast\u003e20161230132931\u003c/last\u003e\u003ccount\u003e17\u003c/count\u003e\u003cchannel\u003eFTcom\u003c/channel\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e37\u003c/id\u003e\u003ctp\u003emms\u003c/tp\u003e\u003cc\u003eservlet-mms\u003c/c\u003e\u003ccd\u003e20161230132900\u003c/cd\u003e\u003cdt\u003e\u003csrcUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/srcUuid\u003e\u003ctrgUuid\u003ef9845f8a-c210-11e6-91a7-e73ace06f770\u003c/trgUuid\u003e\u003csrcRepo\u003eTEST-cms-read\u003c/srcRepo\u003e\u003ctrgRepo\u003eTEST-cma-write\u003c/trgRepo\u003e\u003cts\u003e1483104573\u003c/ts\u003e\u003ccls\u003ecom.eidosmedia.mms.task.extendedobjectmigrationtask.object.ExtendedObjectImpl\u003c/cls\u003e\u003cseq\u003earchive_on_publish_optimised\u003c/seq\u003e\u003cjob\u003earchive_on_publish_optimised_job\u003c/job\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e38\u003c/id\u003e\u003ctp\u003ePublisher\u003c/tp\u003e\u003cc\u003esinghn\u003c/c\u003e\u003ccd\u003e20161230150200\u003c/cd\u003e\u003cdt\u003e\u003cpublishedDate\u003eFri Dec 30 15:02:49 GMT 2016\u003c/publishedDate\u003e\u003c/dt\u003e\u003c/t\u003e\u003ct\u003e\u003cid\u003e2\u003c/id\u003e\u003ctp\u003eweb_publication\u003c/tp\u003e\u003cc\u003esinghn\u003c/c\u003e\u003ccd\u003e20161230150200\u003c/cd\u003e\u003cdt\u003e\u003cwebpublish\u003e\u003csite_url\u003ehttp://www.ft.com/cms/s/f9845f8a-c210-11e6-91a7-e73ace06f770.html\u003c/site_url\u003e\u003csynd_url\u003ehttp://www.ft.com/cms/s/f9845f8a-c210-11e6-91a7-e73ace06f770,s01=1.html\u003c/synd_url\u003e\u003c/webpublish\u003e\u003c/dt\u003e\u003c/t\u003e\u003c/tl\u003e","uuid":"4b8201d9-ed4f-4a97-b5cf-8cc7aa3af46e","value":"PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIGRvYyBTWVNURU0gIi9TeXNDb25maWcvUnVsZXMvZnRwc2kuZHRkIj4KPD9FTS1kdGRFeHQgL1N5c0NvbmZpZy9SdWxlcy9mdHBzaS9mdHBzaS5kdHg/Pjw/RU0tdGVtcGxhdGVOYW1lIC9TeXNDb25maWcvVGVtcGxhdGVzL0ZUL0Jhc2UtU3RvcnkueG1sPz48P3htbC1mb3JtdGVtcGxhdGUgL1N5c0NvbmZpZy9UZW1wbGF0ZXMvRlQvQmFzZS1TdG9yeS54cHQ/Pgo8P3htbC1zdHlsZXNoZWV0IHR5cGU9InRleHQvY3NzIiBocmVmPSIvU3lzQ29uZmlnL1J1bGVzL2Z0cHNpL0ZUL21haW5yZXAuY3NzIj8+PGRvYyB4bWw6bGFuZz0iZW4tdWsiPgo8bGVhZCBpZD0iVTExMTA1NTc5ODI2NzBXaEYiPjxsZWFkLWhlYWRsaW5lIGlkPSJVMTExMDU1Nzk4MjY3MHBYQiI+PG5pZC10aXRsZT48bG4+PD9FTS1kdW1teVRleHQgW0luc2VydCBuZXdzIGluIGRlcHRoIHRpdGxlIGhlcmVdPz4KPC9sbj4KPC9uaWQtdGl0bGU+PGluLWRlcHRoLW5hdi10aXRsZT48bG4+PD9FTS1kdW1teVRleHQgW0luc2VydCBpbiBkZXB0aCBuYXYgdGl0bGUgaGVyZV0/Pgo8L2xuPgo8L2luLWRlcHRoLW5hdi10aXRsZT4KPGhlYWRsaW5lIGlkPSJVNzY1NzIzNTc4MzVBTkUiPjxsbj48YSBocmVmPSJodHRwczovL2hvd3Rvc3BlbmRpdC5mdC5jb20vdGVjaG5vbG9neT90aXRsZT0xMTcwNzMtbGVpY2FzLWdyaXBwaW5nLWNvbGxhYm9yYXRpb24td2l0aC1hcnRpc3QtYW5kLWRlc2lnbmVyLXJvbGYtc2FjaHMiIHRpdGxlPSJMZWljYeKAmXMgZ3JpcHBpbmcgY29sbGFib3JhdGlvbiB3aXRoIGFydGlzdCBhbmQgZGVzaWduZXIgUm9sZiBTYWNocyI+TGVpY2HigJlzIGdyaXBwaW5nIGNvbGxhYm9yYXRpb24gd2l0aCBhcnRpc3QgYW5kIGRlc2lnbmVyIFJvbGYgU2FjaHM8L2E+PC9sbj48L2hlYWRsaW5lPgo8c2t5Ym94LWhlYWRsaW5lIGlkPSJVMTg1MjMwNzE4MDdnWVoiPjxsbj48P0VNLWR1bW15VGV4dCBbSW5zZXJ0IHNreWJveCBoZWFkbGluZSBoZXJlXT8+PC9sbj4KPC9za3lib3gtaGVhZGxpbmU+PHRyaXBsZXQtaGVhZGxpbmU+PGxuPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgdHJpcGxldCBoZWFkbGluZSBoZXJlXT8+CjwvbG4+CjwvdHJpcGxldC1oZWFkbGluZT48cHJvbW9ib3gtdGl0bGU+PGxuPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgcHJvbW9ib3ggdGl0bGUgaGVyZV0/Pgo8L2xuPgo8L3Byb21vYm94LXRpdGxlPjxwcm9tb2JveC1oZWFkbGluZT48bG4+PD9FTS1kdW1teVRleHQgW0luc2VydCBwcm9tb2JveCBoZWFkbGluZSBoZXJlXT8+CjwvbG4+CjwvcHJvbW9ib3gtaGVhZGxpbmU+PGVkaXRvci1jaG9pY2UtaGVhZGxpbmUgaWQ9IlUzMzE1MTE0ODEyM05NZCI+PGxuPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgc3RvcnkgcGFja2FnZSBoZWFkbGluZSBoZXJlXT8+CjwvbG4+CjwvZWRpdG9yLWNob2ljZS1oZWFkbGluZT48bmF2LWNvbGxlY3Rpb24taGVhZGxpbmU+PGxuPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgbmF2IGNvbGxlY3Rpb24gaGVhZGxpbmUgaGVyZV0/Pgo8L2xuPgo8L25hdi1jb2xsZWN0aW9uLWhlYWRsaW5lPjxpbi1kZXB0aC1uYXYtaGVhZGxpbmU+PGxuPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgaW4gZGVwdGggbmF2IGhlYWRsaW5lIGhlcmVdPz4KPC9sbj4KPC9pbi1kZXB0aC1uYXYtaGVhZGxpbmU+PC9sZWFkLWhlYWRsaW5lPjx3ZWItaW5kZXgtaGVhZGxpbmUgaWQ9IlU3NDQ2MDA4NjI2N0RIdyI+PGxuPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgd2ViIGluZGV4IGhlYWRsaW5lIGhlcmUgLSBtYXggNDEgY2hhcnNdPz4KPC9sbj4KPC93ZWItaW5kZXgtaGVhZGxpbmU+CjxsZWFkLWltYWdlcz4KICAgPHdlYi1tYXN0ZXIgaWQ9IlU2NjA1Mjg1NzUzM0NibSIgZmlsZXJlZj0iaHR0cDovL3d3dy5nb29nbGUuY29tL2JsdWUvZGEvYmEvZGVlP3V1aWQ9c29tZS11dWlkIiAvPgogICA8d2ViLXNreWJveC1waWN0dXJlIGlkPSJVODExNTAxMDEzNDF3d0EiLz48d2ViLWFsdC1waWN0dXJlIGlkPSJVNjcwNjE3MDQ2MDhDdFoiLz48d2ViLXBvcHVwLXByZXZpZXcgaGVpZ2h0PSI5NiIgaWQ9IlUwODgyNTI0NTAwOGZZaiIgd2lkdGg9IjE2NyIvPjx3ZWItcG9wdXAgaWQ9IlU0Mjg2MjgyNzE2NUN4eCIvPjwvbGVhZC1pbWFnZXM+PGludGVyYWN0aXZlLWNoYXJ0Pjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgaW50ZXJhY3RpdmUtY2hhcnQgbGluayAgaGVyZV0/Pgo8L2ludGVyYWN0aXZlLWNoYXJ0Pjx3ZWItc3ViaGVhZCBpZD0iVTUzMjgxODMxMDU0S0FSIj48cD5UaW1lbGluZTogNDQgeWVhcnMgb2YgYnJhbmQtYnVpbGRpbmc8L3A+Cjwvd2ViLXN1YmhlYWQ+PHdlYi1zdGFuZC1maXJzdCBpZD0iVTg3ODMxNzAzODE0SHpHIj48cD5IaSwgdGhpcyBpcyBteSBuZXdzIGFydGljbGU8L3A+PC93ZWItc3RhbmQtZmlyc3Q+CjxsZWFkLXRleHQgaWQ9IlUxMTEwNTU3OTgyNjcwb1NGIj48bGVhZC1ib2R5PjxwPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgbGVhZCBib2R5IHRleHQgaGVyZSAtIG1pbiAxMzAgY2hhcnMsIG1heCAxNTAgY2hhcnNdPz48L3A+CjwvbGVhZC1ib2R5Pjx0cmlwbGV0LWxlYWQtYm9keT48cD48P0VNLWR1bW15VGV4dCBbSW5zZXJ0IHRyaXBsZXQgbGVhZCBib2R5IGJvZHkgaGVyZV0/Pgo8L3A+CjwvdHJpcGxldC1sZWFkLWJvZHk+PGNvbHVtbmlzdC1sZWFkLWJvZHk+PHA+PD9FTS1kdW1teVRleHQgW0luc2VydCBjb2x1bW5pc3QgbGVhZCBib2R5IGJvZHkgaGVyZV0/Pgo8L3A+CjwvY29sdW1uaXN0LWxlYWQtYm9keT48c2hvcnQtYm9keT48cD48P0VNLWR1bW15VGV4dCBbSW5zZXJ0IHNob3J0IGJvZHkgYm9keSBoZXJlXT8+CjwvcD4KPC9zaG9ydC1ib2R5Pjxza3lib3gtYm9keT48cD48P0VNLWR1bW15VGV4dCBbSW5zZXJ0IHNreWJveCBib2R5IGhlcmVdPz4KPC9wPgo8L3NreWJveC1ib2R5Pjxwcm9tb2JveC1ib2R5PjxwPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgcHJvbW9ib3ggYm9keSBoZXJlXT8+CjwvcD4KPC9wcm9tb2JveC1ib2R5Pjx0cmlwbGV0LXNob3J0LWJvZHk+PHA+PD9FTS1kdW1teVRleHQgW0luc2VydCB0cmlwbGV0IHNob3J0IGJvZHkgaGVyZV0/Pgo8L3A+CjwvdHJpcGxldC1zaG9ydC1ib2R5PjxlZGl0b3ItY2hvaWNlLXNob3J0LWxlYWQtYm9keT48cD48P0VNLWR1bW15VGV4dCBbSW5zZXJ0IGVkaXRvcnMgY2hvaWNlIHNob3J0IGxlYWQgYm9keSBoZXJlXT8+CjwvcD4KPC9lZGl0b3ItY2hvaWNlLXNob3J0LWxlYWQtYm9keT48bmF2LWNvbGxlY3Rpb24tc2hvcnQtbGVhZC1ib2R5PjxwPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgbmF2IGNvbGxlY3Rpb24gc2hvcnQgbGVhZCBib2R5IGhlcmVdPz4KPC9wPgo8L25hdi1jb2xsZWN0aW9uLXNob3J0LWxlYWQtYm9keT48L2xlYWQtdGV4dD48ZWRpdG9yLWNob2ljZSBpZD0iVTM3NDYyMjU2ODgzYUFjIi8+PHRhYmxldD48dGFibGV0LWltYWdlcz48dGFibGV0LW1hc3RlciBpZD0iVTAzNDYwMDIwNTIzT1B4Ii8+PC90YWJsZXQtaW1hZ2VzPjx0YWJsZXQtaGVhZGxpbmU+PGxuPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgdGFibGV0IGhlYWRsaW5lIGhlcmVdPz4KPC9sbj4KPC90YWJsZXQtaGVhZGxpbmU+PHRhYmxldC1zdW1tYXJ5PjxwPjw/RU0tZHVtbXlUZXh0IFtJbnNlcnQgdGFibGV0IHN1bW1hcnkgaGVyZV0/Pgo8L3A+CjwvdGFibGV0LXN1bW1hcnk+PC90YWJsZXQ+PC9sZWFkPjxzdG9yeSBpZD0iVTc1NDM3NDA1ODMwT3JFIj48aGVhZGJsb2NrIGlkPSJVMTExMDU1Nzk4MjY3MGt5SCI+PGhlYWRsaW5lIGlkPSJVNDgzNzM4MDA4ODNTYXoiPjxsbj48P0VNLWR1bW15VGV4dCBbSGVhZGxpbmVdPz4KPC9sbj4KPC9oZWFkbGluZT48L2hlYWRibG9jaz48dGV4dCBpZD0iVTExMTA1NTc5ODI2NzBsNkQiPjxieWxpbmU+QnnCoDxhdXRob3ItbmFtZT5BbGVrc2FuZHJhIFdpc25pZXdza2E8L2F1dGhvci1uYW1lPjwvYnlsaW5lPjxib2R5PjxwPldoYXQgc3RhcnRlZCBhcyBhIHJlY29yZCBjb21wYW55IGRlbGl2ZXJpbmcgdmlueWwgcmVjb3JkcyBieSBwb3N0IGhhcyBncm93biBpbnRvIGEgY29uZ2xvbWVyYXRlIG9mIG1vcmUgdGhhbiA0MDAgYnVzaW5lc3NlcyByYW5naW5nIGZyb20gdGVsZWNvbXMgdG8gYnJpZGFsIHdlYXIuIEp1Z2dsaW5nIHNwYWNlc2hpcHMsIG1vcnRnYWdlcywgdm9ka2EgYm90dGxlcyBhbmQgd2VkZGluZyBkcmVzc2VzIG1hZGUgU2lyIFJpY2hhcmQgQnJhbnNvbiwgVmlyZ2lu4oCZcyBjaGFpcm1hbiwgdGhlIHNldmVudGggcmljaGVzdCBiaWxsaW9uYWlyZSBpbiB0aGUgVUsgd2l0aCBhIG5ldCB3b3J0aCBhcHByb2FjaGluZyAkNSBibi4gVmlyZ2lu4oCZcyB1bm9ydGhvZG94IGNvcnBvcmF0ZSBzdHJ1Y3R1cmUgbWF5IGhhdmUgcmFpc2VkIGEgY291cGxlIG9mIGV5ZWJyb3dzIGJ1dCBoYXZlIG5vdCB5ZXQgZmFpbGVkIHRvIGZpbmFuY2UgaXRzIGZvdW5kZXLigJlzIHJpc2t5IHZlbnR1cmVzIGFuZCBkYXJpbmcgZXhwbG9pdHMuIFRlc3QgTHVjYTwvcD4KPHA+PGEgaHJlZj0iaHR0cDovL3d3dy5mdC5jb20vaWcvc2l0ZXMvMjAxNC92aXJnaW5ncm91cC10aW1lbGluZS8iIHRpdGxlPSJUaW1lbGluZTogVGhlIFZpcmdpbiBlbXBpcmUgLSBGVC5jb20iPlZpZXcgdGhlIGludGVyYWN0aXZlIGdyYXBoaWM8L2E+PC9wPgo8L2JvZHk+PC90ZXh0Pjwvc3Rvcnk+PC9kb2M+Cg==","workflowStatus":""}`

func TestHash(t *testing.T) {
	result1 := Hash(exampleNativePayload)
	result2 := Hash(exampleNativePayload)

	assert.Equal(t, "e6e2ddb24efd029a44b7c2117d172c2e89e88992eb453b3807b693c4", result1, "Hash should always compute the same value!")
	assert.Equal(t, result1, result2, "Hash should always compute the same value!")
}

func TestHashCheckMatches(t *testing.T) {
	passed := false
	next := func(w http.ResponseWriter, r *http.Request) {
		passed = true
	}

	content := make(map[string]interface{})
	json.Unmarshal([]byte(exampleNativePayload), &content)

	expectedResource := &mapper.Resource{
		UUID:        "a-real-uuid",
		Content:     content,
		ContentType: "application/json",
	}

	mongo := new(MockDB)
	connection := new(MockConnection)

	mongo.On("Open").Return(connection, nil)
	connection.On("Read", "methode", "a-real-uuid").Return(expectedResource, true, nil)

	router := mux.NewRouter()
	router.HandleFunc("/{collection}/{resource}", Filter(next).CheckNativeHash(mongo).Build()).Methods("PUT")

	body := &mapper.MockBody{Body: strings.NewReader(`{}`)}
	body.On("Close").Return(nil)

	w := httptest.NewRecorder()
	req, _ := http.NewRequest("PUT", "/methode/a-real-uuid", body)
	req.Header.Add("X-Native-Hash", "e6e2ddb24efd029a44b7c2117d172c2e89e88992eb453b3807b693c4")

	router.ServeHTTP(w, req)

	mock.AssertExpectationsForObjects(t, mongo, body)
	assert.False(t, passed)
	assert.Equal(t, http.StatusOK, w.Code)
}

func TestHashCheckDoesntMatch(t *testing.T) {
	passed := false
	next := func(w http.ResponseWriter, r *http.Request) {
		passed = true
	}

	content := make(map[string]interface{})
	json.Unmarshal([]byte(exampleNativePayload), &content)

	expectedResource := &mapper.Resource{
		UUID:        "a-real-uuid",
		Content:     content,
		ContentType: "application/json",
	}

	mongo := new(MockDB)
	connection := new(MockConnection)

	mongo.On("Open").Return(connection, nil)
	connection.On("Read", "methode", "a-real-uuid").Return(expectedResource, true, nil)

	router := mux.NewRouter()
	router.HandleFunc("/{collection}/{resource}", Filter(next).CheckNativeHash(mongo).Build()).Methods("PUT")

	body := &mapper.MockBody{Body: strings.NewReader(`{}`)}
	body.On("Close").Return(nil)

	w := httptest.NewRecorder()
	req, _ := http.NewRequest("PUT", "/methode/a-real-uuid", body)
	req.Header.Add("X-Native-Hash", "any-other-value")

	router.ServeHTTP(w, req)

	mock.AssertExpectationsForObjects(t, mongo, body)
	assert.False(t, passed)
	assert.Equal(t, http.StatusConflict, w.Code)
}

func TestNoContentFound(t *testing.T) {
	passed := false
	next := func(w http.ResponseWriter, r *http.Request) {
		passed = true
	}

	mongo := new(MockDB)
	connection := new(MockConnection)

	mongo.On("Open").Return(connection, nil)
	connection.On("Read", "methode", "a-real-uuid").Return(&mapper.Resource{}, false, nil)

	router := mux.NewRouter()
	router.HandleFunc("/{collection}/{resource}", Filter(next).CheckNativeHash(mongo).Build()).Methods("PUT")

	body := &mapper.MockBody{Body: strings.NewReader(`{}`)}
	body.On("Close").Return(nil)

	w := httptest.NewRecorder()
	req, _ := http.NewRequest("PUT", "/methode/a-real-uuid", body)
	req.Header.Add("X-Native-Hash", "e6e2ddb24efd029a44b7c2117d172c2e89e88992eb453b3807b693c4")

	router.ServeHTTP(w, req)

	mock.AssertExpectationsForObjects(t, mongo, body)
	assert.False(t, passed)
	assert.Equal(t, http.StatusConflict, w.Code)
}

func TestHashCheckContentReadFails(t *testing.T) {
	passed := false
	next := func(w http.ResponseWriter, r *http.Request) {
		passed = true
	}

	mongo := new(MockDB)
	connection := new(MockConnection)

	mongo.On("Open").Return(connection, nil)
	connection.On("Read", "methode", "a-real-uuid").Return(&mapper.Resource{}, false, errors.New("i failed"))

	router := mux.NewRouter()
	router.HandleFunc("/{collection}/{resource}", Filter(next).CheckNativeHash(mongo).Build()).Methods("PUT")

	body := &mapper.MockBody{Body: strings.NewReader(`{}`)}
	body.On("Close").Return(nil)

	w := httptest.NewRecorder()
	req, _ := http.NewRequest("PUT", "/methode/a-real-uuid", body)
	req.Header.Add("X-Native-Hash", "e6e2ddb24efd029a44b7c2117d172c2e89e88992eb453b3807b693c4")

	router.ServeHTTP(w, req)

	mock.AssertExpectationsForObjects(t, mongo, body)
	assert.False(t, passed)
	assert.Equal(t, http.StatusServiceUnavailable, w.Code)
}

func TestHashCheckJsonMarshalFails(t *testing.T) {
	passed := false
	next := func(w http.ResponseWriter, r *http.Request) {
		passed = true
	}

	expectedResource := &mapper.Resource{
		UUID:        "a-real-uuid",
		Content:     func() {},
		ContentType: "application/json",
	}

	mongo := new(MockDB)
	connection := new(MockConnection)

	mongo.On("Open").Return(connection, nil)
	connection.On("Read", "methode", "a-real-uuid").Return(expectedResource, true, nil)

	router := mux.NewRouter()
	router.HandleFunc("/{collection}/{resource}", Filter(next).CheckNativeHash(mongo).Build()).Methods("PUT")

	body := &mapper.MockBody{Body: strings.NewReader(`{}`)}
	body.On("Close").Return(nil)

	w := httptest.NewRecorder()
	req, _ := http.NewRequest("PUT", "/methode/a-real-uuid", body)
	req.Header.Add("X-Native-Hash", "e6e2ddb24efd029a44b7c2117d172c2e89e88992eb453b3807b693c4")

	router.ServeHTTP(w, req)

	mock.AssertExpectationsForObjects(t, mongo, body)
	assert.False(t, passed)
	assert.Equal(t, http.StatusServiceUnavailable, w.Code)
}

func TestNoHashCheckIfNoHeader(t *testing.T) {
	passed := false
	next := func(w http.ResponseWriter, r *http.Request) {
		passed = true
	}

	mongo := new(MockDB)
	connection := new(MockConnection)

	mongo.On("Open").Return(connection, nil)

	router := mux.NewRouter()
	router.HandleFunc("/{collection}/{resource}", Filter(next).CheckNativeHash(mongo).Build()).Methods("PUT")

	body := &mapper.MockBody{Body: strings.NewReader(`{}`)}

	w := httptest.NewRecorder()
	req, _ := http.NewRequest("PUT", "/methode/a-real-uuid", body)

	router.ServeHTTP(w, req)

	mock.AssertExpectationsForObjects(t, mongo, body)
	assert.True(t, passed)
	assert.Equal(t, http.StatusOK, w.Code)
}

func TestFailedMongoDuringHashFilter(t *testing.T) {
	next := func(w http.ResponseWriter, r *http.Request) {
		t.Fail()
	}

	mongo := new(MockDB)
	mongo.On("Open").Return(nil, errors.New("no data 4 u"))

	router := mux.NewRouter()
	router.HandleFunc("/{collection}/{resource}", Filter(next).CheckNativeHash(mongo).Build()).Methods("PUT")

	body := &mapper.MockBody{Body: strings.NewReader(`{}`)}
	body.On("Close").Return(nil)

	w := httptest.NewRecorder()
	req, _ := http.NewRequest("PUT", "/methode/a-real-uuid", body)

	router.ServeHTTP(w, req)

	mock.AssertExpectationsForObjects(t, mongo, body)
	assert.Equal(t, http.StatusServiceUnavailable, w.Code)
}
